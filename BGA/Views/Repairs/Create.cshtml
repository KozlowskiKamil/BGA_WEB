@model BGA.Entites.Repair


<div class="container p-4">
    <div class="row my-3">
        <div class="col-md-12 col-12">
            <div class="tile2">
                <ul class="list-group">
                    <li class="list-group-item active" aria-current="true">Wymiana BGA</li>
                </ul>
                <form asp-action="Create" id="repairForm">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="row my-3">
                        <div class="col-md-6 col-12">
                            <div class="col-auto ms-5 mb-3">
                                <label asp-for="LocalDate" class="control-label"></label>
                                <input asp-for="LocalDate" class="form-control" id="localDate" />
                                <span asp-validation-for="LocalDate" class="text-danger"></span>
                            </div>
                            <div class="col-auto ms-5 mb-3">
                                <label asp-for="Client" class="control-label"></label>
                                <select asp-for="Client" class="form-control" id="client">
                                    <option value="">-- Select Client --</option>
                                    <option value="ALSTOM">ALSTOM</option>
                                    <option value="AXIS">AXIS</option>
                                    <option value="Bosch">Bosch</option>
                                    <option value="BSH">BSH</option>
                                    <option value="L_AND_G">L+G</option>
                                    <option value="ENOVATES">Enovates</option>
                                    <option value="EVBOX">EvBox</option>
                                </select>
                                <span asp-validation-for="Client" class="text-danger"></span>
                            </div>
                            <div class="col-auto ms-5 mb-3">
                                <label asp-for="TesterProcess" class="control-label"></label>
                                <input asp-for="TesterProcess" class="form-control" id="testerProcess"/>
                                <span asp-validation-for="TesterProcess" class="text-danger"></span>
                            </div>
                            <div class="col-auto ms-5 mb-3">
                                <label asp-for="Defect" class="control-label"></label>
                                <input asp-for="Defect" class="form-control" id="defect"/>
                                <span asp-validation-for="Defect" class="text-danger"></span>
                            </div>
                            <div class="col-auto ms-5 mb-3">
                                <label asp-for="RepairMethod" class="control-label"></label>
                                <input asp-for="RepairMethod" class="form-control" id="repairMethod"/>
                                <span asp-validation-for="RepairMethod" class="text-danger"></span>
                            </div>
                            <div class="col-auto ms-5 mb-3">
                                <label asp-for="Machine" class="control-label"></label>
                                <input asp-for="Machine" class="form-control" id="machine"/>
                                <span asp-validation-for="Machine" class="text-danger"></span>
                            </div>
                            <div class="ms-5">
                                <input type="submit" value="Create" class="btn btn-primary" />
                            </div>
                        </div>
                        <div class="col-md-6 col-12">
                            <div class="col-auto me-5 mb-3">
                                <label asp-for="Name" class="control-label"></label>
                                <input asp-for="Name" class="form-control" id="name"/>
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>
                            <div class="col-auto me-5 mb-3">
                                <label asp-for="Analysis" class="control-label"></label>
                                <input asp-for="Analysis" class="form-control" id="analysis"/>
                                <span asp-validation-for="Analysis" class="text-danger"></span>
                            </div>
                            <div class="col-auto me-5 mb-3">
                                <label asp-for="LocationComponent" class="control-label"></label>
                                <input asp-for="LocationComponent" class="form-control" id="locationComponent"/>
                                <span asp-validation-for="LocationComponent" class="text-danger"></span>
                            </div>
                            <div class="col-auto me-5 mb-3">
                                <label asp-for="Comment" class="control-label"></label>
                                <input asp-for="Comment" class="form-control" id="comment" />
                                <span asp-validation-for="Comment" class="text-danger"></span>
                            </div>
                            <div class="col-auto me-5 mb-3">
                                <label asp-for="SerialNumber" class="control-label"></label>
                                <input asp-for="SerialNumber" class="form-control" id="serialNumber"/>
                                <span asp-validation-for="SerialNumber" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous">
    </script>
</div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $('#saveButton').click(function () {
            submitForm(); // Wywołaj funkcję wysyłania formularza
        });

        $('#repairForm').submit(function (event) {
            event.preventDefault(); // Zapobiegaj domyślnej akcji formularza
            submitForm(); // Wywołaj funkcję wysyłania formularza
        });

        // Funkcja wysyłająca formularz
        function submitForm() {
            // Sprawdzanie, czy pola wymagane są wypełnione
            if ($('#serialNumber').val() === '' || $('#defect').val() === '' || $('#locationComponent').val() === '' || $('#testerProcess').val() === '' || $('#machine').val() === '' || $('#localDate').val() === '' || $('#name').val() === '' || $('#client').val() === '' || $('#analysis').val() === '' || $('#repairMethod').val() === '') {
                alert("Wypełnij wszystkie wymagane pola formularza!");
                return;
            }

            // Zapisywanie danych do localStorage
            localStorage.setItem('defect', $('#defect').val());
            localStorage.setItem('name', $('#name').val());
            localStorage.setItem('client', $('#client').val());
            localStorage.setItem('testerProcess', $('#testerProcess').val());
            localStorage.setItem('machine', $('#machine').val());
            localStorage.setItem('analysis', $('#analysis').val());
            localStorage.setItem('repairMethod', $('#repairMethod').val());
            localStorage.setItem('localDate', $('#localDate').val());
            localStorage.setItem('locationComponent', $('#locationComponent').val());

            // Wysyłanie danych za pomocą AJAX
            $.ajax({
                type: 'POST',
                url: '/',
                data: $('#repairForm').serialize(),
                success: function (response) {
                    $('.scrollable-table tbody').append(response);
                    location.reload();
                },
                error: function (xhr, status, error) {
                    window.location.href = '/add';
                }
            });
        }

        $('#repairForm input').keypress(function (event) {
            // Sprawdź, czy wciśnięto klawisz Enter
            if (event.which === 13) {
                event.preventDefault(); // Zapobiegaj domyślnej akcji formularza
                submitForm(); // Wywołaj funkcję wysyłania formularza
            }
        });

        // Pobieranie danych z localStorage i wypełnianie pól formularza
        var defect = localStorage.getItem('defect');
        var name = localStorage.getItem('name');
        var client = localStorage.getItem('client');
        var testerProcess = localStorage.getItem('testerProcess');
        var machine = localStorage.getItem('machine');
        var analysis = localStorage.getItem('analysis');
        var repairMethod = localStorage.getItem('repairMethod');
        var localDate = localStorage.getItem('localDate');
        var locationComponent = localStorage.getItem('locationComponent');

        if (defect) $('#defect').val(defect);
        if (name) $('#name').val(name);
        if (client) $('#client').val(client);
        if (testerProcess) $('#testerProcess').val(testerProcess);
        if (machine) $('#machine').val(machine);
        if (analysis) $('#analysis').val(analysis);
        if (repairMethod) $('#repairMethod').val(repairMethod);
        if (localDate) $('#localDate').val(localDate);
        if (locationComponent) $('#locationComponent').val(locationComponent);
    });
</script>

@section Scripts {
    @{
    await Html.RenderPartialAsync("_ValidationScriptsPartial");
}
}